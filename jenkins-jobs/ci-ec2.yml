- job-template:
    name: 'ec2-pulp-{version}-{branch}-automation-on-{os}'
    concurrent: true
    disabled: false
    workspace: /var/lib/jenkins/jenkins-jobs-pulp-{version}-{os}
    display-name: 'ec2-pulp-{version}-automation-on-{os}'
    description: 'Do not edit this job through the web!'
    node: 'rhel7-np'
    wrappers:
      - ci-ec2-wrapper
    builders:
      - ci-ec2-builder-credentials
      - shell: |
          rm -rf pulp-automation-ci
          git clone https://github.com/peterlacko/pulp-automation-ci
          cd pulp-automation-ci
          cp -v $ANSIBLE_EC2_CREDENTIALS/ansible-pulp-automation-placko.pem .
          ansible-playbook -i ec2.py automation-deploy.yml --extra-vars @global_vars.yml
          ansible-playbook -i ec2.py automation-configure.yml --extra-vars @global_vars.yml
          ansible-playbook -i ec2.py automation-run.yml --extra-vars @global_vars.yml
    triggers:
      - build-result:
          groups:
            - jobs:
                - build-automation-repo-{version}-{branch}
    publishers:
      # Take the node offline so that another build doesn't pile on
      - groovy-postbuild: "manager.build.getBuiltOn().toComputer().setTemporarilyOffline(true)"

- job-template:
    name: 'ec2-setup-automation-runner'
    displayname: 'ec2-setup-automation-runner'
    concurrent: true
    disabled: false
    workspace: /var/lib/jenkins/jenkins-jobs-automation-runner
    description: 'Do not edit this job through the web!'
    node: 'rhel7-np'
    wrappers:
      - ci-ec2-wrapper
    builders:
      - ci-ec2-builder-credentials
      - shell: |
          sudo yum -y install python-boto
          rm -rf pulp-automation-ci
          git clone https://github.com/peterlacko/pulp-automation-ci
          cd pulp-automation-ci
          cp -v $ANSIBLE_EC2_CREDENTIALS/ansible-pulp-automation-placko.pem .
          ansible-playbook -i ec2.py automation-runner-deploy.yml --extra-vars @global_vars.yml
          ansible-playbook -i ec2.py automation-runner-configure.yml --extra-vars @global_vars.yml
    triggers:
      - timed: '@monthly'
    publishers:
      # Take the node offline so that another build doesn't pile on
      - groovy-postbuild: "manager.build.getBuiltOn().toComputer().setTemporarilyOffline(true)"

          
- project:
    name: pulp-automation
    jobs:
      - 'ec2-pulp-{version}-{branch}-automation-on-{os}'
      - 'ec2-setup-automation-runner'
    version:
      - 2.6
    branch:
      - testing
    os:
      - rhel6
      - rhel7
